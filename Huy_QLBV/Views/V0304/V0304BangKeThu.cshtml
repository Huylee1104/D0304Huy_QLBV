@{
    Layout = null;
}
@{
    var jsonHTTT = Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.DSHTTT);
}
@{
    var jsonNhanVien = Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.DSNhanVien);
}
@{
    var list = ViewBag.Data as List<Huy_QLBV.Models.M0304.M0304Huy_Mau4>;
}
@{
    var stt = 1;
}
<!DOCTYPE html>
<html>
<head>
    <title>Index</title>
    <link rel="stylesheet" href="@Url.Content("~/dist/css/W0304/W0304_Report.css")" />
    <link rel="stylesheet" href="@Url.Content("~/dist/libs/bootstrap/dist/css/bootstrap.min.css")" />
    <link rel="stylesheet" href="@Url.Content("~/dist/libs/bootstrap/dist/css/bootstrap.min.css")" />
    <link rel="stylesheet" href="@Url.Content("~/dist/libs/bootstrap-datepicker/css/bootstrap-datepicker.min.css")" />
    <link rel="stylesheet" href="@Url.Content("~/dist/libs/bootstrap-icons/font/bootstrap-icons.css")" />
</head>
<body>
    <div class="card p-1">
        <div class="content">
            <div class="loc">
                <div>
                    <form id="myForm" action="~/C0304BangKeThu/Index" method="post">
                        <div class="item">
                            <label for="myDate" class="form-label">Đến ngày</label>
                            <div class="input-group date" id="datepicker">
                                <input type="text" class="form-control" id="myDate" name="NgayBatDau"
                                       placeholder="dd-mm-yyyy" autocomplete="off" value="@ViewBag.NgayBatDau" data-ngay="@ViewBag.NgayBatDau" />
                                <span class="input-group-text" id="datepicker-icon">
                                    <i class="bi bi-calendar-date"></i>
                                </span>
                            </div>
                        </div>
                        <div class="item">
                            <label for="myDate2" class="form-label">Đến ngày</label>
                            <div class="input-group date" id="datepicker2">
                                <input type="text" class="form-control" id="myDate2" name="NgayKetThuc"
                                       placeholder="dd-mm-yyyy" autocomplete="off" value="@ViewBag.NgayKetThuc" data-ngay2="@ViewBag.NgayKetThuc" />
                                <span class="input-group-text" id="datepicker-icon2">
                                    <i class="bi bi-calendar-date"></i></span>
                            </div>
                        </div>
                        <div class="item">
                            <label for="NhanVien">Nhân viên</label>
                            <input type="text" id="comboBox2" name="tenNhanVien" data-value="@ViewBag.tenNhanVien">
                            <input type="hidden" id="IDNhanVien" name="IDNhanVien" data-value="@ViewBag.IDNhanVien" />
                            <div class="dropdownList" id="dropdownList2"></div>
                        </div>
                        <div class="item">
                            <label for="HTTT">Hình thức thanh toán</label>
                            <input type="text" id="comboBox" name="tenHTTT" data-value="@ViewBag.tenHTTT">
                            <input type="hidden" id="IDHTTT" name="IDHTTT" data-value="@ViewBag.IDHTTT" />
                            <div class="dropdownList" id="dropdownList"></div>
                        </div>
                        <input type="hidden" id="IDChiNhanh" name="IDChiNhanh" />
                        <div class="item">
                            <div class="button">
                                <div>
                                    <button class="btn btn-primary" type="submit">Tải Danh sách</button>
                                </div>
                                <div>
                                    <a href="~/C0304BangKeThu/ExportPdf" class="btn btn-danger" target="_blank">
                                        PDF
                                    </a>
                                </div>
                                <div>
                                    <a href="~/C0304BangKeThu/ExportExcel" class="btn btn-success">
                                        Excel
                                    </a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="view">
                <div class="table-wrapper">
                    <table class="form_table">
                        <thead>
                            <tr class="mau_header">
                                <th class="giua">STT</th>
                                <th class="giua">Mã y tế</th>
                                <th class="giua">Họ và tên</th>
                                <th class="giua">Quyển sổ</th>
                                <th class="giua">Số biên lai</th>
                                <th class="giua">Loại</th>
                                <th class="giua">Ngày thu</th>
                                <th class="giua">Hủy</th>
                                <th class="giua">Hoàn</th>
                                <th class="giua">Số tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (list != null && list.Count > 0)
                            {
                                foreach (var item in list)
                                {
                                    <tr>
                                        <td class="giua">@stt</td>
                                        <td class="giua">@item.MaYTe</td>
                                        <td class="trai">@item.HoVaTen</td>
                                        <td class="giua">@item.QuyenSo</td>
                                        <td class="giua">@item.SoBienLai</td>
                                        <td class="giua">@item.Loai</td>
                                        <td class="giua">@(item.NgayThu?.ToString("dd/MM/yyyy"))</td>
                                        <td class="phai">@(item.Huy.HasValue? item.Huy.Value.ToString("N2", System.Globalization.CultureInfo.InvariantCulture) : "")</td>
                                        <td class="phai">@(item.Hoan.HasValue? item.Hoan.Value.ToString("N2", System.Globalization.CultureInfo.InvariantCulture) : "")</td>
                                        <td class="phai">@(item.SoTien.HasValue? item.SoTien.Value.ToString("N2", System.Globalization.CultureInfo.InvariantCulture) : "")</td>
                                    </tr>
                                    stt++;
                                }
                            }
                        </tbody>
                    </table>
                </div>
                <div class="phan_trang">

                </div>
            </div>
        </div>
    </div>
    <script>
        const provincesDataHTTT = @Html.Raw(jsonHTTT);
    </script>
    <script>
        const provincesDataNhanVien = @Html.Raw(jsonNhanVien);
    </script>
    <script src="~/dist/libs/jquery/dist/jquery.min.js"></script>
    <script src="~/dist/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/dist/libs/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="~/dist/libs/bootstrap-datepicker/locales/bootstrap-datepicker.vi.min.js"></script>
    <script src="@Url.Content("~/dist/js/W0304/combobox.js")"></script>
    <script src="@Url.Content("~/dist/js/W0304/BienChung.js")"></script>
    <script src="@Url.Content("~/dist/js/W0304/W0304_Report.js")"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            ["comboBox2", "IDNhanVien", "comboBox", "IDHTTT"].forEach(id => {
                const el = document.getElementById(id);
                if (el && el.dataset.value) {
                    el.value = el.dataset.value;
                }
            });
        });
        document.getElementById('IDChiNhanh').value = _idcn;
    </script>
</body>
</html>
